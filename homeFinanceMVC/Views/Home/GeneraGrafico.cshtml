
@{
    ViewBag.Title = "GeneraGrafico";
    Layout = "~/Views/Shared/_Layout.cshtml";

    string deForm = Session["de"].ToString();
    string hastaForm = Session["hasta"].ToString();

    string tp = Session["tipo"].ToString();


    if(tp == "rece")
    {
        tp = "Entradas";
    }
    else
    {
        tp = "Despiezas";
    }

    string de = String.Format("{0}/{1}/{2}", @deForm.Substring(8), @deForm.Substring(5, 2), @deForm.Substring(0, 4));
    string hasta = String.Format("{0}/{1}/{2}", @hastaForm.Substring(8), @hastaForm.Substring(5, 2), @hastaForm.Substring(0, 4));

}

<div class="alert alert-info" role="alert">
    <h3 style="color:blue;margin-left:10px">Grafico de <b> @tp </b> del Periodo De <b>@de</b>  Hasta <b>@hasta</b></h3>
</div>


<div class="row" style="margin-left:25%">
    <div class="col-md-4">
        <button type="button" id="chartBtn" class="btn btn-primary pulse">Generar Grafico</button>
        @Html.ActionLink("Volver", "Grafico", "Home", null, new { @class = "btn btn-info" })
    </div>
</div>

<main>
    <div class="row">
        <div class="col-md-12">
            <div id="chartArea"></div>
        </div>
    </div>
</main>
@*</div>*@

@section scripts
{
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>

    <script>
        $(document)
            .ready(function() {

                $('#chartBtn').click(function() {
                    $.ajax({
                        type: "GET",
                        url: '@Url.Action("GetCharData")',
                        dataType: "json",
                        success: function(data) {
                            var series = [
                                {
                                    type: 'pie',
                                    name: '',
                                    data: data
                                }
                            ];

                            createChart("#chartArea", "", series);
                        }
                    });
                });

            });

        function createChart(chartcontainer, title, series) {

            $(chartcontainer)
                .highcharts({

                    chart: {
                        type: 'pie',
                    },
                    credits: {
                        enabled: false,
                    },
                    exporting: {
                        enabled: true,
                    },
                    plotOptions: {
                        pie: {
                            allowPointSelect: true,
                            cursor: 'pointer',
                            dataLabels: {
                                enabled: true,
                                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                                style: {
                                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                                },

                                connectorColor: 'silver'

                            }
                        }
                    },
                    series: series,
                    title: {
                        text: title
                    }


                });

        }



    </script>



}

